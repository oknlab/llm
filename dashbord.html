<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Multi-Agent System Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .status-item.online {
            border-left: 4px solid #00ff88;
        }
        
        .status-item.offline {
            border-left: 4px solid #ff4444;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,212,255,0.3);
        }
        
        .card-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #00d4ff;
        }
        
        .agent-card {
            background: linear-gradient(135deg, rgba(42,82,152,0.2) 0%, rgba(30,60,114,0.2) 100%);
            cursor: pointer;
        }
        
        .agent-card.active {
            border: 2px solid #00ff88;
            box-shadow: 0 0 30px rgba(0,255,136,0.4);
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .metric-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .control-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #00d4ff;
            font-weight: 600;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        button {
            background: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%);
            color: #0a0a0a;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,212,255,0.5);
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .output-panel {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(0,212,255,0.3);
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .output-panel pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #00ff88;
            font-family: 'Courier New', monospace;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            border-left: 3px solid #00d4ff;
        }
        
        .log-entry.error {
            border-left-color: #ff4444;
        }
        
        .log-entry.success {
            border-left-color: #00ff88;
        }
        
        .timestamp {
            color: #888;
            font-size: 0.85em;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Elite Multi-Agent Orchestration System</h1>
            <p>Enterprise-grade AI agent framework with RAG, Airflow & Real-time Analytics</p>
            <div class="status-bar">
                <div class="status-item online" id="system-status">
                    <strong>System:</strong> <span id="status-text">Initializing...</span>
                </div>
                <div class="status-item" id="model-status">
                    <strong>Model:</strong> <span id="model-text">Loading...</span>
                </div>
                <div class="status-item">
                    <strong>API:</strong> <span id="api-url">{{API_URL}}</span>
                </div>
                <div class="status-item">
                    <strong>Uptime:</strong> <span id="uptime">0s</span>
                </div>
            </div>
        </header>

        <div class="grid">
            <!-- Agent Cards -->
            <div class="card agent-card" data-agent="CodeArchitect">
                <div class="card-title">üîß CodeArchitect</div>
                <p>Engineering expert: Python, JS, Rust, Go, APIs, system architecture</p>
                <div class="metric">
                    <span>Executions:</span>
                    <span class="metric-value" id="exec-CodeArchitect">0</span>
                </div>
            </div>

            <div class="card agent-card" data-agent="SecAnalyst">
                <div class="card-title">üõ°Ô∏è SecAnalyst</div>
                <p>Security: Penetration testing, audits, threat modeling</p>
                <div class="metric">
                    <span>Executions:</span>
                    <span class="metric-value" id="exec-SecAnalyst">0</span>
                </div>
            </div>

            <div class="card agent-card" data-agent="AutoBot">
                <div class="card-title">‚öôÔ∏è AutoBot</div>
                <p>Automation: API integration, FastAPI, n8n, Zapier workflows</p>
                <div class="metric">
                    <span>Executions:</span>
                    <span class="metric-value" id="exec-AutoBot">0</span>
                </div>
            </div>

            <div class="card agent-card" data-agent="AgentSuite">
                <div class="card-title">üìä AgentSuite</div>
                <p>Operations: Scheduling, reports, financial analysis, workflows</p>
                <div class="metric">
                    <span>Executions:</span>
                    <span class="metric-value" id="exec-AgentSuite">0</span>
                </div>
            </div>

            <div class="card agent-card" data-agent="CreativeAgent">
                <div class="card-title">üé® CreativeAgent</div>
                <p>Content: High-quality textual, audio, visual generation</p>
                <div class="metric">
                    <span>Executions:</span>
                    <span class="metric-value" id="exec-CreativeAgent">0</span>
                </div>
            </div>

            <div class="card agent-card" data-agent="AgCustom">
                <div class="card-title">üî® AgCustom</div>
                <p>Custom: Build tailored AI agents for specific requirements</p>
                <div class="metric">
                    <span>Executions:</span>
                    <span class="metric-value" id="exec-AgCustom">0</span>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <h2 class="card-title">üéõÔ∏è Agent Control Panel</h2>
            
            <div class="input-group">
                <label for="agent-select">Select Agent:</label>
                <select id="agent-select">
                    <option value="CodeArchitect">CodeArchitect - Engineering</option>
                    <option value="SecAnalyst">SecAnalyst - Security</option>
                    <option value="AutoBot">AutoBot - Automation</option>
                    <option value="AgentSuite">AgentSuite - Operations</option>
                    <option value="CreativeAgent">CreativeAgent - Content</option>
                    <option value="AgCustom">AgCustom - Custom Build</option>
                </select>
            </div>

            <div class="input-group">
                <label for="task-input">Task Description:</label>
                <textarea id="task-input" placeholder="Enter your task or query here..."></textarea>
            </div>

            <button id="execute-btn" onclick="executeAgent()">‚ñ∂ Execute Agent</button>
            <button onclick="executeRAG()" style="margin-left: 10px; background: linear-gradient(135deg, #ff4444 0%, #ff8800 100%);">üîç RAG Query</button>

            <div class="output-panel" id="output">
                <pre id="output-text">Ready for execution...</pre>
            </div>
        </div>

        <!-- Metrics Dashboard -->
        <div class="grid">
            <div class="card">
                <div class="card-title">üìà System Metrics</div>
                <div class="metric">
                    <span>Total Requests:</span>
                    <span class="metric-value" id="total-requests">0</span>
                </div>
                <div class="metric">
                    <span>Successful:</span>
                    <span class="metric-value" id="success-requests">0</span>
                </div>
                <div class="metric">
                    <span>Failed:</span>
                    <span class="metric-value" id="failed-requests">0</span>
                </div>
                <div class="metric">
                    <span>Success Rate:</span>
                    <span class="metric-value" id="success-rate">100%</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üìù Activity Log</div>
                <div class="output-panel" style="max-height: 300px;" id="activity-log">
                    <div class="log-entry">System initialized</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '{{API_URL}}';
        let selectedAgent = 'CodeArchitect';
        let ws = null;
        let startTime = Date.now();

        // WebSocket connection
        function connectWebSocket() {
            const wsUrl = API_URL.replace('http', 'ws') + '/ws';
            ws = new WebSocket(wsUrl);
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'metrics_update') {
                    updateMetrics(data.data);
                }
            };
            
            ws.onerror = () => {
                addLog('WebSocket connection error', 'error');
            };
            
            ws.onclose = () => {
                setTimeout(connectWebSocket, 5000);
            };
        }

        // Update metrics display
        function updateMetrics(metrics) {
            document.getElementById('total-requests').textContent = metrics.requests_total || 0;
            document.getElementById('success-requests').textContent = metrics.requests_success || 0;
            document.getElementById('failed-requests').textContent = metrics.requests_failed || 0;
            
            const successRate = metrics.requests_total > 0 
                ? ((metrics.requests_success / metrics.requests_total) * 100).toFixed(1)
                : 100;
            document.getElementById('success-rate').textContent = successRate + '%';

            // Update agent execution counts
            if (metrics.agents_executed) {
                for (const [agent, count] of Object.entries(metrics.agents_executed)) {
                    const elem = document.getElementById(`exec-${agent}`);
                    if (elem) elem.textContent = count;
                }
            }
        }

        // Execute agent task
        async function executeAgent() {
            const agent = document.getElementById('agent-select').value;
            const task = document.getElementById('task-input').value;

            if (!task.trim()) {
                alert('Please enter a task description');
                return;
            }

            const btn = document.getElementById('execute-btn');
            btn.disabled = true;
            btn.classList.add('loading');
            
            document.getElementById('output-text').textContent = '‚è≥ Executing agent...';

            try {
                const response = await fetch(`${API_URL}/agent/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agent, task })
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('output-text').textContent = 
                        `‚úÖ Agent: ${result.agent}\n\n${result.result}`;
                    addLog(`${agent} executed successfully`, 'success');
                } else {
                    document.getElementById('output-text').textContent = 
                        `‚ùå Error: ${result.detail}`;
                    addLog(`Execution failed: ${result.detail}`, 'error');
                }
            } catch (error) {
                document.getElementById('output-text').textContent = 
                    `‚ùå Network error: ${error.message}`;
                addLog(`Network error: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }

        // RAG query
        async function executeRAG() {
            const query = document.getElementById('task-input').value;

            if (!query.trim()) {
                alert('Please enter a query');
                return;
            }

            document.getElementById('output-text').textContent = 'üîç Searching and retrieving...';

            try {
                const response = await fetch(`${API_URL}/rag/query`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('output-text').textContent = 
                        `üìö RAG Answer:\n\n${result.answer}\n\n` +
                        `üìé Sources (${result.sources.length}):\n` +
                        result.sources.map((s, i) => `${i+1}. ${s}`).join('\n');
                    addLog('RAG query completed', 'success');
                } else {
                    document.getElementById('output-text').textContent = 
                        `‚ùå Error: ${result.detail}`;
                    addLog(`RAG query failed`, 'error');
                }
            } catch (error) {
                document.getElementById('output-text').textContent = 
                    `‚ùå Network error: ${error.message}`;
            }
        }

        // Add log entry
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('activity-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `
                <span class="timestamp">${new Date().toLocaleTimeString()}</span> - ${message}
            `;
            logContainer.insertBefore(entry, logContainer.firstChild);
            
            // Keep only last 20 entries
            while (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // Agent card selection
        document.querySelectorAll('.agent-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.agent-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                const agent = card.dataset.agent;
                document.getElementById('agent-select').value = agent;
            });
        });

        // Health check
        async function checkHealth() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    document.getElementById('status-text').textContent = 'Online ‚úì';
                    document.getElementById('system-status').classList.add('online');
                    document.getElementById('model-text').textContent = 
                        data.model_loaded ? 'Qwen3-1.7B Loaded ‚úì' : 'Loading...';
                }
            } catch (error) {
                document.getElementById('status-text').textContent = 'Offline ‚úó';
                document.getElementById('system-status').classList.remove('online');
                document.getElementById('system-status').classList.add('offline');
            }
        }

        // Update uptime
        function updateUptime() {
            const seconds = Math.floor((Date.now() - startTime) / 1000);
            const hours = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            document.getElementById('uptime').textContent = 
                `${hours}h ${mins}m ${secs}s`;
        }

        // Initialize
        checkHealth();
        connectWebSocket();
        setInterval(checkHealth, 30000);
        setInterval(updateUptime, 1000);
        addLog('Dashboard initialized', 'success');
    </script>
</body>
</html>
